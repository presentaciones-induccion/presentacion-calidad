---
# title: "Capacitaci칩n en R y herramientas de productividad"
# author: "Abril 2021"
format:
  revealjs:
    auto-stretch: false
    margin: 0
    slide-number: true
    scrollable: true
    preview-links: auto
    logo: imagenes/logo_portada2.png
    css: ine_quarto_styles.css
    # footer: <https://quarto.org>
---

# 

<img src="imagenes/logo_portada2.png" width="20%"/>

[**Antecedentes paquete y aplicativo calidad**]{.big-par .center-justified}

[**Subdirecci칩n T칠cnica**]{.big-par .center-justified}

[**Proyecto Ciencia de Datos**]{.big-par .center-justified}

[**Octubre 2023**]{.big-par .center-justified}


# [쯈u칠 significa calidad estad칤stica? 쮺칩mo la medimos?]{.biggest}

## Algunas medidas

::: {.medium-par .incremental}
- Error est치ndar
- Coeficiente de variaci칩n
- Coeficiente de variaci칩n logar칤tmico
- Grados de libertad
- Tama침o de muestra
- Tama침o de muestra efectivo
- Deff
- Intervalo de confianza
- Entre otros



:::

## Est치ndar INE

En 2020 el INE publica un est치ndar de calidad para las estimaciones con **encuestas de hogares**

Departamento de Metodolog칤a e Innovaci칩n Estad칤stica

<span class="center-justified">
<img src="imagenes/estandar_ine.png" width="900" />
</span>

## Est치ndar INE

**Cuadro estad칤stico**: arreglo ordenado de los datos procesados para facilitar la lectura e interpretaci칩n

<br>
<span class="center-justified">
<img src="imagenes/tabla2.png" width="900" />
</span>


## Est치ndar INE

- **Tama침o muestral (tm)**, unidades de an치lisis que nutren las estimaciones (viviendas, hogares y/o personas)

* **Grados de libertad (gl)** 
  + [Tratamiento diferenciado para las proporciones y razones definidas entre 0 y 1]{.custom-par}

<img src="imagenes/grados_libertad.png" width="800" />

* **Coeficiente de variaci칩n / error est치ndar**

  + Proporci칩n y razones definidas entre 0 y 1: **SE**
  
  + Resto: **CV**


## Dicotom칤a de las proporciones

<br>
<br>

<span class="center-justified">
<img src="imagenes/se_cv.png" width="900" />
</span>

## Flujograma calidad

<br/>

<span class="center-justified">
<img src="imagenes/flujo7.png" width="1000" />
</span>



## Introducci칩n paquete calidad

**쮺칩mo pasar del documento a la pr치ctica?**

<span class="center-justified">
<img src="https://media.giphy.com/media/a5viI92PAF89q/giphy.gif" width="200" />
</span>

. . .

Existen m칰ltiples herramientas (Stata, R, SAS, Python) y todas son v치lidas


. . .

El paquete **calidad** implementa el est치ndar mediante R

. . .

**Objetivos del paquete**

::: {.incremental .medium-par}
- Facilitar la aplicaci칩n del est치ndar a usuarios externos
- Aumentar la eficiencia en el trabajo de los analistas
- Reducir la probabilidad de error en la implementaci칩n
:::



## Est치ndar CEPAL


::: panel-tabset 
## [CEPAL]{.medium-par} 
<span class="center-justified">
<img src="imagenes/estandar_cepal.png" width="350" />
</span>

## [Nuevos indicadores]{.medium-par}

::: {.incremental .medium-par}
- coeficiente de variaci칩n logar칤tmico 
- tama침o de muestra efectivo 
- conteo de casos no ponderado
- leve diferencia en grados de libertad

:::

## [Ampliaci칩n]{.medium-par}

**쮺칩mo le damos autonom칤a a los usuarios?**

**쯈u칠 pasa si quiero crear un est치ndar nuevo?**

**쯈u칠 pasa si quiero mejorar mi est치ndar**

:::


## Incorporaci칩n est치ndar de CEPAL



::: columns
::: {.column width="40%"}
<span class="center-justified">
<img src="imagenes/flujo_cepal.png" width="400" />
</span>
:::

::: {.column width="40%"}
::: fragment

<br/>

**Suprimir** 

**Revisar**

**Publicar**
:::
:::
:::




## Introducci칩n paquete calidad

El paquete **calidad** combina conceptos de calidad con el paquete **survey**, desarrollado por Thomas Lumley

<span class="center-justified">
<img src="imagenes/ecuacion.png" width="450" />
</span>

. . .

**La versi칩n estable incluye**

::: {.medium-par}
- media
- proporciones
- tama침os (totales poblacionales)
- totales 
:::


. . .

**Combina est치ndares**

 

## Demostraci칩n paquete calidad

Versi칩n estable desde CRAN

```{r, eval=F, echo=TRUE}
install.packages("calidad")
```

. . .

... o versi칩n en desarrollo, desde [github](https://github.com/inesscc/calidad)

```{r, eval=F, echo=TRUE}
devtools::install_github("inesscc/calidad")
```

. . .

Apliquemos el est치ndar del INE a los datos de CASEN 2022 

```{r, echo=FALSE}
library(calidad)
library(survey)
library(kableExtra)
library(dplyr)
library(feather)
options(survey.lonely.psu = "certainty")

```


```{r}



#library(haven)
# casen <- read_dta("data/Base de datos Casen 2022 STATA.dta")
# casen_compacta <- casen %>% 
#   select(sexo, pobreza, expr, activ, region, cod_upm, estrato) %>% 
#   mutate(hombre = if_else(sexo==1,1,0),
#                            mujer = if_else(sexo==2,1,0),
#                            fdt = if_else(activ %in% c(1, 2), 1, 0, missing = 0), # fuerza de trabajo
#                            ocupado = if_else(activ == 1, 1, 0, missing = 0), # persona ocupada
#                            desocupado = if_else(activ == 2, 1, 0, missing = 0), # persona desocupada
#                            metro = if_else(region == 13, 1, 0),
#                            pobre_extremo = if_else(pobreza == 1,1,0),
#                            pobre_no_extremo = if_else(pobreza == 2,1,0),
#                            pobre = if_else(pobreza %in% c(1,2),1,0),
#                            no_pobre = if_else(pobreza == 3,1,0))
# 
# 
# write_feather(casen_compacta, "data/casen_compacta.feather")


```

```{r, results='hide'}
casen_compacta <-  read_feather("data/casen_compacta.feather")
dc <- svydesign(weights = ~expr, ids = ~cod_upm, strata = ~estrato, data = casen_compacta )
pobreza_sexo <-  create_prop("pobre", domains = "hombre", design = dc)
```


```{r, echo=TRUE, results='hide'}
pobreza_sexo <-  create_prop("pobre", domains = "hombre", design = dc)
assess(pobreza_sexo)


```
```{r}
assess(pobreza_sexo) %>% 
  kbl() %>% 
  kable_styling(font_size = 14)
```

## Agreguemos dominios

```{r, echo=TRUE, results='hide'}
pobreza_sexo_region <-  create_prop("pobre", domains = "hombre+region", design = dc)
assess(pobreza_sexo_region)
```

```{r}
assess(pobreza_sexo_region) %>% 
  kbl() %>% 
  kable_styling(font_size = 14)
```

## Miremos la fuerza de trabajo

```{r, echo=TRUE, results='hide'}
pobreza_sexo_region_ocup <-  create_prop("pobre",
                                         domains = "hombre+region+ocupado",
                                         subpop = "fdt",
                                         design = dc)
assess(pobreza_sexo_region_ocup)
```


```{r}
assess(pobreza_sexo_region_ocup) %>% 
  kbl() %>% 
  kable_styling(font_size = 14)
```



## Aplicando est치ndar CEPAL

Nuevos par치metros

```{r, results='hide', echo=TRUE, `code-line-numbers`="5-8"}
pobreza_sexo_region_ocup_cepal <-  create_prop("pobre", 
                                   domains = "hombre+region+ocupado",
                                   subpop = "fdt",
                                   design = dc,
                                   ess = TRUE,
                                   deff = T, 
                                   unweighted = T, 
                                   log_cv = T)
assess(pobreza_sexo_region_ocup_cepal, scheme = "eclac")
```

```{r, echo=FALSE}
assess(pobreza_sexo_region_ocup_cepal,  scheme = "eclac") %>% 
  kbl() %>% 
  kable_styling(font_size = 14)
```


## Cambiando umbrales

Podemos fijar nuestros propios criterios

```{r, results="hide", echo=TRUE}
pobreza_sexo_region_ocup_cepal <-  create_prop("pobre", 
                                   domains = "hombre+region+ocupado",
                                   subpop = "fdt",
                                   design = dc,
                                   ess = TRUE,
                                   deff = T, 
                                   unweighted = T, 
                                   log_cv = T)
assess(pobreza_sexo_region_ocup_cepal, 
       scheme = "eclac", 
       df = 120)
```


```{r}
assess(pobreza_sexo_region_ocup_cepal, 
       scheme = "eclac", 
       df = 120) %>% 
  kbl() %>% 
  kable_styling(font_size = 14)
```


## Tabla formateada

::: panel-tabset 

## [output formateado]{.medium-par} 

```{r, echo=TRUE}
assess(pobreza_sexo_region_ocup_cepal, 
       scheme = "eclac", 
       df = 120) %>% 
  create_html()
```

## [hardcodeo]{.medium-par} 

La funci칩n create_html est치 *hardcodeada* en los formatos 

游삒游삒游삒

Hay que trabajar en ella

Para hacer esta presentaci칩n, tuve que modificar la clase table

```{css, eval = FALSE, echo = TRUE}
.table {
  font-size: 11px;
}

```

[쯌oluntarios/as?]{.center}

:::

## Desaf칤os

**Menor complejidad**

:::{.incremental .medium-par}
- Reparar la funci칩n de medianas (r칠plicas)
- Mejorar create_html
:::

. . .

**Mayor complejidad**

:::{.incremental .medium-par}
- Dejar de depender de survey
- Calcular por nosotros mismos la varianza
:::
. . .

[Inscripciones abiertas :)]{.big-par .center} 


# 

```{=html}
<!---
# TODO: this does not work
 .linea-superior[]
.linea-inferior[] 
--->
```
```{=html}
<!---
# TODO: this does not work
 ![](imagenes/logo_portada2.png){.center style="width: 20%;"}   
--->
```
<img src="imagenes/logo_portada2.png" width="20%"/>

[**Antecedentes paquete y aplicativo calidad**]{.big-par .center-justified}

[**Subdirecci칩n T칠cnica**]{.big-par .center-justified}

[**Proyecto Ciencia de Datos**]{.big-par .center-justified}

[**Octubre 2023**]{.big-par .center-justified}
